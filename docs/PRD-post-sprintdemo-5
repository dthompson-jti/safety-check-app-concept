## PRD 5: Data Architecture & Persistence (Evaluation & Optimization)
**Priority:** Low (High Effort/Complexity) | **Risk:** High

### 1. Overview
Address the data derivation bottlenecks and implement session persistence to make the prototype feel "real" across reloads.

### 2. Problem & Goals
*   **Problem:** Reloading the page resets the view to "Time" and "Card" mode. Search filtering runs on every keystroke across the entire dataset.
*   **Goals:** Persist user preferences. Optimize filtering. Evaluate changing the state library (e.g., to Zustand or XState).

### 3. Scope & Key Initiatives
*   **Persistence:** Use `atomWithStorage` for `appConfigAtom` and `sessionAtom`.
*   **Draft State:** Cache form inputs in `localStorage` keyed by `checkId` so "Back" doesn't lose data.
*   **Optimization:** Debounce the search input atom.
*   **State Lib Evaluation:** (Internal Note) Jotai is working well for this atomic structure. Switching to Redux/Zustand would be a rewrite. The recommendation is to *stick with Jotai* but use its advanced features (Split atoms / atom families) if performance degrades further.

### 4. UX/UI Specification
*   *Behavioral changes only.* The app "remembers" where you were.

### 5. Architecture & Implementation Plan
1.  **Persistence:**
    *   Replace `atom<AppConfig>` with `atomWithStorage<AppConfig>('app-config', default)`.
2.  **Drafts:**
    *   Create a `draftsAtom` (Map<CheckId, FormData>).
    *   `CheckFormView` initializes from `draftsAtom`.
3.  **Search:**
    *   Create `debouncedSearchQueryAtom` that updates 300ms after the raw input atom.
    *   Point filters to the debounced atom.

### 6. File Manifest
*   `src/data/atoms.ts` [MODIFIED]
*   `src/data/appDataAtoms.ts` [MODIFIED]
*   `src/features/Workflow/CheckFormView.tsx` [MODIFIED]

### 7. Unintended Consequences Check
*   **Schema Evolution:** If we change the `AppConfig` shape, `localStorage` might crash the app on load.
*   **Mitigation:** Add a version check or try/catch block in the storage initialization to wipe old data if schema mismatches.

### 8. Risks & Mitigations
*   **Risk:** Stale drafts showing up for a resident whose status has changed.
*   **Mitigation:** Clear draft on successful submission.

### 9. Definition of Done
*   [ ] Reloading the page preserves "List View" preference.
*   [ ] Typing in search doesn't lag (debounced).
*   [ ] Clicking "Back" then returning to the form restores typed notes.